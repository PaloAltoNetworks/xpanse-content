contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.5.0
    itemVersion: 1.7.53
    packID: ""
    packName: Cortex Attack Surface Management
    prevname: ""
    toServerVersion: ""
description: 'TODO Edit Given the IP address this playbook enriches ServiceNow CMDB
  information relevant to ASM alerts. '
dirtyInputs: true
id: 'Cortex EM - ServiceNow CMDB'
inputSections:
- description: Generic group for inputs
  inputs:
  - IPv4
  - IPv6
  - HostName
  - FQDN
  name: General (Inputs group)
inputs:
- description: IPv4 address
  key: IPv4
  playbookInputQuery: null
  required: false
  value: {}
- description: IPv6 address
  key: IPv6
  playbookInputQuery: null
  required: false
  value: {}
- description: Hostname
  key: HostName
  playbookInputQuery: null
  required: false
  value: {}
- description: Fully Qualified Domain Name
  key: FQDN
  playbookInputQuery: null
  required: false
  value: {}
name: Cortex EM - ServiceNow CMDB
outputSections:
- description: Generic group for outputs
  name: General (Outputs group)
  outputs: []
outputs: []
sourceplaybookid: Cortex ASM - ServiceNow CMDB Enrichment
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "33"
      - "34"
      - "35"
      - "36"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ccbd8af5-6610-414d-8bb4-8a6f51ff03c4
      iscommand: false
      name: ""
      version: -1
    taskid: ccbd8af5-6610-414d-8bb4-8a6f51ff03c4
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 400,
          "y": -190
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ce26c438-8508-46fd-800b-9877e08ea44f
      iscommand: false
      name: Set Field
      type: title
      version: -1
    taskid: ce26c438-8508-46fd-800b-9877e08ea44f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 400,
          "y": 580
        }
      }
  "2":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: ServiceNow v2
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if the "ServiceNow v2" integration instance is enabled
        in order to find email accounts for ServiceNow usernames.
      id: fd96653d-f7f8-46c0-8047-53ce7867f52b
      iscommand: false
      name: Is ServiceNow v2 enabled?
      type: condition
      version: -1
    taskid: fd96653d-f7f8-46c0-8047-53ce7867f52b
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1070
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    scriptarguments:
      user_id:
        complex:
          accessor: value
          root: ServiceNowCMDB.Record.Attributes.assigned_to
    separatecontext: false
    skipunavailable: false
    task:
      brand: ServiceNow v2
      description: Pull information on the user that was "assigned_to" for a CMDB
        object.
      id: 629e5269-2647-4cd1-893c-89e7c4004968
      iscommand: true
      name: Pull ServiceNow user information
      script: ServiceNow v2|||servicenow-query-users
      type: regular
      version: -1
    taskid: 629e5269-2647-4cd1-893c-89e7c4004968
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -280,
          "y": 1240
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: bf6e3dd3-84f6-4a93-8c42-32048ab95f4d
      iscommand: false
      name: Service Owner
      type: title
      version: -1
    taskid: bf6e3dd3-84f6-4a93-8c42-32048ab95f4d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -10,
          "y": 940
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      gridfield:
        simple: emassetownerunrankedraw
      keys:
        simple: name,email,source,timestamp
      val1:
        complex:
          accessor: display_value
          root: ServiceNowCMDB.Record.Attributes.assigned_to
          transformers:
          - operator: uniq
      val2:
        simple: n/a
      val3:
        simple: SNOW-CMDB
      val4:
        simple: TIMESTAMP
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      id: e982b8cd-4ae2-4473-8d60-35bfa7e3f648
      iscommand: false
      name: Set service owner grid field (no email)
      script: GridFieldSetup
      type: regular
      version: -1
    taskid: e982b8cd-4ae2-4473-8d60-35bfa7e3f648
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 120,
          "y": 1400
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      gridfield:
        simple: emassetownerunrankedraw
      keys:
        simple: name,email,source,timestamp
      val1:
        complex:
          accessor: display_value
          root: ServiceNowCMDB.Record.Attributes.assigned_to
          transformers:
          - operator: uniq
      val2:
        complex:
          accessor: Email
          root: ServiceNow.User
          transformers:
          - operator: uniq
      val3:
        simple: SNOW-CMDB
      val4:
        simple: TIMESTAMP
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      id: 11590e11-166b-4a22-8615-4f24f095e100
      iscommand: false
      name: Set service owner grid field (email)
      script: GridFieldSetup
      type: regular
      version: -1
    taskid: 11590e11-166b-4a22-8615-4f24f095e100
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -280,
          "y": 1400
        }
      }
  "12":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: display_value
                root: ServiceNowCMDB.Record.Attributes.assigned_to
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "4"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if there is ServiceNow assigned_to information to set
        in the service owner field.
      id: d08b03b9-fa57-401c-8a6b-07c5c18dc7d9
      iscommand: false
      name: Is there ServiceNow assigned_to information?
      type: condition
      version: -1
    taskid: d08b03b9-fa57-401c-8a6b-07c5c18dc7d9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 720
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      scriptArguments:
        BypassAddRecord:
          simple: "true"
        SearchCIClass:
          simple: cmdb_ci
        SearchQueryField:
          simple: ip_address
        SearchQueryValue:
          complex:
            root: inputs.RemoteIP
      wait: 1
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    scriptarguments:
      BypassAddRecord:
        simple: "true"
      SearchCIClass:
        simple: cmdb_ci
      SearchQueryField:
        simple: ip_address
      SearchQueryValue:
        simple: ${inputs.IPv6}
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |
        Subplaybook for finding CI records in ServiceNow CMDB.
      id: 928b8e47-c235-4fe1-8226-01cb1c44dc2a
      iscommand: false
      name: ServiceNow CMDB Search
      playbookId: ServiceNow CMDB Search
      type: playbook
      version: -1
    taskid: 928b8e47-c235-4fe1-8226-01cb1c44dc2a
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 190,
          "y": 260
        }
      }
  "26":
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6945b9ec-3395-4b6b-8b71-dbb8ef47e163
      iscommand: false
      name: Complete
      type: title
      version: -1
    taskid: 6945b9ec-3395-4b6b-8b71-dbb8ef47e163
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 400,
          "y": 1590
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      scriptArguments:
        BypassAddRecord:
          simple: "true"
        SearchCIClass:
          simple: cmdb_ci
        SearchQueryField:
          simple: ip_address
        SearchQueryValue:
          complex:
            root: inputs.RemoteIP
      wait: 1
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    scriptarguments:
      BypassAddRecord:
        simple: "true"
      SearchCIClass:
        simple: cmdb_ci
      SearchQueryField:
        simple: name
      SearchQueryValue:
        simple: ${inputs.HostName}
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |
        Subplaybook for finding CI records in ServiceNow CMDB.
      id: 0f2a2883-246a-427d-869d-bf4958016d47
      iscommand: false
      name: ServiceNow CMDB Search
      playbookId: ServiceNow CMDB Search
      type: playbook
      version: -1
    taskid: 0f2a2883-246a-427d-869d-bf4958016d47
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 580,
          "y": 260
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      scriptArguments:
        BypassAddRecord:
          simple: "true"
        SearchCIClass:
          simple: cmdb_ci
        SearchQueryField:
          simple: ip_address
        SearchQueryValue:
          complex:
            root: inputs.RemoteIP
      wait: 1
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    scriptarguments:
      BypassAddRecord:
        simple: "true"
      SearchCIClass:
        simple: cmdb_ci
      SearchQueryField:
        simple: fqdn
      SearchQueryValue:
        simple: ${inputs.FQDN}
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |
        Subplaybook for finding CI records in ServiceNow CMDB.
      id: 07121524-cfc9-4e97-8caa-4ea1f4e9e25e
      iscommand: false
      name: ServiceNow CMDB Search
      playbookId: ServiceNow CMDB Search
      type: playbook
      version: -1
    taskid: 07121524-cfc9-4e97-8caa-4ea1f4e9e25e
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 972.5,
          "y": 260
        }
      }
  "32":
    continueonerrortype: ""
    id: "32"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      forEach: true
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    scriptarguments:
      BypassAddRecord:
        simple: "true"
      SearchCIClass:
        simple: cmdb_ci
      SearchQueryField:
        simple: ip_address
      SearchQueryValue:
        simple: ${inputs.IPv4}
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |
        Subplaybook for finding CI records in ServiceNow CMDB.
      id: ab073223-2aee-4932-823d-690577740ab2
      iscommand: false
      name: ServiceNow CMDB Search
      playbookId: ServiceNow CMDB Search
      type: playbook
      version: -1
    taskid: ab073223-2aee-4932-823d-690577740ab2
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -200,
          "y": 260
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "37"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 2e68e998-a709-498a-818d-2af8cc851dae
      iscommand: false
      name: IPv4
      type: title
      version: -1
    taskid: 2e68e998-a709-498a-818d-2af8cc851dae
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -200,
          "y": -50
        }
      }
  "34":
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "38"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 4b43b7e9-188d-42b4-8adf-ddaea3f26f7e
      iscommand: false
      name: IPv6
      type: title
      version: -1
    taskid: 4b43b7e9-188d-42b4-8adf-ddaea3f26f7e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 190,
          "y": -50
        }
      }
  "35":
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "39"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 4c615a26-f3c7-4a37-8437-7167d1ed996a
      iscommand: false
      name: Hostname
      type: title
      version: -1
    taskid: 4c615a26-f3c7-4a37-8437-7167d1ed996a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 580,
          "y": -50
        }
      }
  "36":
    continueonerrortype: ""
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "40"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cc28b055-89b9-490e-8640-d51a236fa354
      iscommand: false
      name: FQDN
      type: title
      version: -1
    taskid: cc28b055-89b9-490e-8640-d51a236fa354
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 972.5,
          "y": -50
        }
      }
  "37":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.IPv4
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "32"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 245e2529-71e7-426d-8261-8a882e9c63fe
      iscommand: false
      name: Have IPv4 input?
      type: condition
      version: -1
    taskid: 245e2529-71e7-426d-8261-8a882e9c63fe
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -200,
          "y": 80
        }
      }
  "38":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.IPv6
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: bfa51c44-5f1a-4867-8e36-55d575e52e7c
      iscommand: false
      name: Have IPv6 input?
      type: condition
      version: -1
    taskid: bfa51c44-5f1a-4867-8e36-55d575e52e7c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 190,
          "y": 80
        }
      }
  "39":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.HostName
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "39"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "30"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 790f57ab-a9f9-4ee6-8661-4b69dcc712a0
      iscommand: false
      name: Have Hostname input?
      type: condition
      version: -1
    taskid: 790f57ab-a9f9-4ee6-8661-4b69dcc712a0
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 580,
          "y": 80
        }
      }
  "40":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.FQDN
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "40"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "31"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fdbbffc7-3a8a-45b5-834e-d95ff7196c68
      iscommand: false
      name: Have FQDN input?
      type: condition
      version: -1
    taskid: fdbbffc7-3a8a-45b5-834e-d95ff7196c68
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 972.5,
          "y": 80
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "12_4_yes": 0.64,
      "2_6_#default#": 0.52
    },
    "paper": {
      "dimensions": {
        "height": 1845,
        "width": 1632.5,
        "x": -280,
        "y": -190
      }
    }
  }
