description: Used as a container folder for all enrichments of ASM alerts.
dirtyInputs: true
id: Cortex ASM - Enrichment - EXPANDR-6313
inputs:
- description: IP address of service
  key: RemoteIP
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: remoteip
      root: alert
- description: If assuming roles for AWS, this is the name of the role to assume (should
    be the same for all organizations).
  key: AWSAssumeRoleName
  playbookInputQuery: null
  required: false
  value: {}
name: Cortex ASM - Enrichment - EXPANDR-6313
outputs:
- contextPath: ASM.ExternalService.externally_detected_providers
  description: Providers of the external service.
  type: unknown
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "103"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 2ebc1504-21ce-4953-85a5-1b596e98a29c
      iscommand: false
      name: ""
      version: -1
    taskid: 2ebc1504-21ce-4953-85a5-1b596e98a29c
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 460,
          "y": 60
        }
      }
  "1":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "97"
      "yes":
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if the IP address has been supplied to proceed with
        cloud enrichment.
      id: 5290c5ba-cf6c-4ada-89ce-f4311f1ce0b8
      iscommand: false
      name: Is there an IP address?
      type: condition
      version: -1
    taskid: 5290c5ba-cf6c-4ada-89ce-f4311f1ce0b8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1575
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "61"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 2ec8de9d-2260-4135-8b19-841253e6d503
      iscommand: false
      name: ServiceNow Enrichment
      type: title
      version: -1
    taskid: 2ec8de9d-2260-4135-8b19-841253e6d503
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2080
        }
      }
  "7":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: alert.asmprovider
          operator: containsGeneral
          right:
            value:
              simple: Amazon Web Services
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: AWS
    - condition:
      - - left:
            iscontext: true
            value:
              simple: alert.asmprovider
          operator: containsGeneral
          right:
            value:
              simple: Google
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: GCP
    - condition:
      - - left:
            iscontext: true
            value:
              simple: alert.asmprovider
          operator: containsGeneral
          right:
            value:
              simple: Azure
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: Azure
    - condition:
      - - left:
            iscontext: true
            value:
              simple: alert.asmprovider
          operator: containsGeneral
          right:
            value:
              simple: On Prem
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: On Prem
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      AWS:
      - "84"
      Azure:
      - "69"
      GCP:
      - "76"
      On Prem:
      - "88"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines which cloud provider the service is in order to direct
        to the correct enrichment.
      id: 4959ec9b-ba2e-4db3-8b75-226a24a8a623
      iscommand: false
      name: What provider is this service?
      type: condition
      version: -1
    taskid: 4959ec9b-ba2e-4db3-8b75-226a24a8a623
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1400
        }
      }
  "11":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Cortex Attack Surface Management
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
          right:
            value: {}
      - - left:
            iscontext: true
            value:
              complex:
                accessor: asmserviceid
                root: alert
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "85"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if the "Cortex Attack Surface Management" integration
        instance is configured and that there is a service to continue with enrichment.
      id: ad889591-ad0f-4ce2-8a41-1f9f5ca5aa7e
      iscommand: false
      name: Is Cortex ASM enabled and is there a service?
      type: condition
      version: -1
    taskid: ad889591-ad0f-4ce2-8a41-1f9f5ca5aa7e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 70,
          "y": 360
        }
      }
  "35":
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 667dc9b9-115f-449b-80ea-f11fd111ab8f
      iscommand: false
      name: Cloud Enrichment
      type: title
      version: -1
    taskid: 667dc9b9-115f-449b-80ea-f11fd111ab8f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1265
        }
      }
  "38":
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a98ef929-a644-487f-8f34-0f06824a667e
      iscommand: false
      name: Complete
      type: title
      version: -1
    taskid: a98ef929-a644-487f-8f34-0f06824a667e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 110,
          "y": 6380
        }
      }
  "61":
    continueonerrortype: ""
    id: "61"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "89"
    note: false
    quietmode: 0
    scriptarguments:
      RemoteIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: c4a053aa-e1d8-48c9-8855-0ed531d62b01
      iscommand: false
      name: Cortex ASM - ServiceNow CMDB Enrichment
      playbookId: Cortex ASM - ServiceNow CMDB Enrichment
      type: playbook
      version: -1
    taskid: c4a053aa-e1d8-48c9-8855-0ed531d62b01
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2210
        }
      }
  "62":
    continueonerrortype: ""
    id: "62"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "63"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: bfc325fe-ee68-45d7-869e-8dfc616f5cd1
      iscommand: false
      name: Tenable.io Enrichment
      type: title
      version: -1
    taskid: bfc325fe-ee68-45d7-869e-8dfc616f5cd1
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2540
        }
      }
  "63":
    continueonerrortype: ""
    id: "63"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "70"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches Tenable.io information
        relevant to ASM alerts.
      id: 3b6df5ad-8c97-4ea3-835d-62e974c56fe9
      iscommand: false
      name: Cortex ASM - Tenable.io Enrichment
      playbookId: Cortex ASM - Tenable.io Enrichment
      type: playbook
      version: -1
    taskid: 3b6df5ad-8c97-4ea3-835d-62e974c56fe9
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2670
        }
      }
  "67":
    continueonerrortype: ""
    id: "67"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    scriptarguments:
      asmprotocol:
        simple: ${ASM.ExternalService.protocol}
      asmprovider:
        simple: ${ASM.ExternalService.externally_detected_providers}
      protocol:
        complex:
          accessor: protocol
          root: ASM.ExternalService
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: d96d32af-bfb2-45f3-8e92-2d0ce97f8289
      iscommand: true
      name: Set protocol
      script: Builtin|||setAlert
      type: regular
      version: -1
    taskid: d96d32af-bfb2-45f3-8e92-2d0ce97f8289
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 70,
          "y": 1090
        }
      }
  "68":
    continueonerrortype: ""
    id: "68"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "78"
    note: false
    quietmode: 0
    scriptarguments:
      active_classifications:
        complex:
          accessor: active_classifications
          root: ASM.ExternalService
      asm_tags:
        complex:
          accessor: asmtags
          root: alert
      hierarchy_info:
        complex:
          accessor: asmassethierarchy
          root: alert
          transformers:
          - args:
              delimiter:
                value:
                  simple: /
            operator: split
      provider:
        complex:
          accessor: provider
          root: alert.asmcloud
          transformers:
          - operator: FirstArrayElement
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Identify whether the service is a "development" server. Development
        servers have no external users and run no production workflows. These servers
        might be named "dev", but they might also be named "qa", "pre-production",
        "user acceptance testing", or use other non-production terms. This automation
        uses both public data visible to anyone (`active_classifications` as derived
        by Xpanse ASM) as well as checking internal data for AI-learned indicators
        of development systems (`asm_tags` as derived from integrations with non-public
        systems).
      id: 7f759117-da21-4a56-843d-0f6e547d1ea0
      iscommand: false
      name: Infer whether service is used for development (vs. production)
      script: InferWhetherServiceIsDev
      type: regular
      version: -1
    taskid: 7f759117-da21-4a56-843d-0f6e547d1ea0
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 110,
          "y": 6030
        }
      }
  "69":
    continueonerrortype: ""
    id: "69"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      RemoteIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address, this playbook enriches Azure information
        relevant to ASM alerts.
      id: d52c70a4-d087-4bfd-848d-d29acead10e1
      iscommand: false
      name: Cortex ASM - Azure Enrichment
      playbookId: Cortex ASM - Azure Enrichment
      type: playbook
      version: -1
    taskid: d52c70a4-d087-4bfd-848d-d29acead10e1
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 1680
        }
      }
  "70":
    continueonerrortype: ""
    id: "70"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "71"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f75f6b46-7cb6-4933-823c-90d52229f8f6
      iscommand: false
      name: Splunk Enrichment
      type: title
      version: -1
    taskid: f75f6b46-7cb6-4933-823c-90d52229f8f6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2830
        }
      }
  "71":
    continueonerrortype: ""
    id: "71"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "73"
    note: false
    quietmode: 0
    scriptarguments:
      IP:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: 'Given the IP address this playbook enriches information from Splunk
        results relevant to ASM alerts. '
      id: 9b7ecc84-5f2b-482d-8f5b-e540d20b7584
      iscommand: false
      name: Cortex ASM - Splunk Enrichment
      playbookId: Cortex ASM - Splunk Enrichment
      type: playbook
      version: -1
    taskid: 9b7ecc84-5f2b-482d-8f5b-e540d20b7584
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2960
        }
      }
  "72":
    continueonerrortype: ""
    id: "72"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "74"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches Rapid7 InsightVM (Nexpose)
        information relevant to ASM alerts.
      id: 5b15509e-aec1-4d0a-8fc8-38196413d55c
      iscommand: false
      name: Cortex ASM - Rapid7 Enrichment
      playbookId: Cortex ASM - Rapid7 Enrichment
      type: playbook
      version: -1
    taskid: 5b15509e-aec1-4d0a-8fc8-38196413d55c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3250
        }
      }
  "73":
    continueonerrortype: ""
    id: "73"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "72"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0fb1a6e6-5098-4aa1-8d15-e3e53590efed
      iscommand: false
      name: Rapid7 Enrichment
      type: title
      version: -1
    taskid: 0fb1a6e6-5098-4aa1-8d15-e3e53590efed
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3120
        }
      }
  "74":
    continueonerrortype: ""
    id: "74"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "75"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 85ae4845-c81d-48b1-874f-3e12b11e56f6
      iscommand: false
      name: Qualys Enrichment
      type: title
      version: -1
    taskid: 85ae4845-c81d-48b1-874f-3e12b11e56f6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3410
        }
      }
  "75":
    continueonerrortype: ""
    id: "75"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "90"
    note: false
    quietmode: 0
    scriptarguments:
      QualysIP:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches information from Qualys
        assets.
      id: ed6d35ed-9d44-486b-889a-7927c02f2a09
      iscommand: false
      name: Cortex ASM - Qualys Enrichment
      playbookId: Cortex ASM - Qualys Enrichment
      type: playbook
      version: -1
    taskid: ed6d35ed-9d44-486b-889a-7927c02f2a09
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3540
        }
      }
  "76":
    continueonerrortype: ""
    id: "76"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches GCP information relevant
        to ASM alerts.
      id: f9662f9d-fd06-4711-8426-019b9be95a22
      iscommand: false
      name: Cortex ASM - GCP Enrichment - EXPANDR-6313
      playbookId: Cortex ASM - GCP Enrichment - EXPANDR-6313
      type: playbook
      version: -1
    taskid: f9662f9d-fd06-4711-8426-019b9be95a22
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 800,
          "y": 1790
        }
      }
  "78":
    continueonerrortype: ""
    id: "78"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "38"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 5ff0d56d-0aba-4e71-8cac-b543a952e0ed
      iscommand: false
      name: Cortex ASM - Service Ownership - EXPANDR-6313
      playbookId: Cortex ASM - Service Ownership - EXPANDR-6313
      type: playbook
      version: -1
    taskid: 5ff0d56d-0aba-4e71-8cac-b543a952e0ed
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 110,
          "y": 6210
        }
      }
  "79":
    continueonerrortype: ""
    id: "79"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "95"
    note: false
    quietmode: 0
    scriptarguments:
      cloudProvider:
        complex:
          accessor: externally_detected_providers
          root: ASM.ExternalService
      remoteIP:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches information from Prisma
        Cloud.
      id: 33b5f244-158e-4055-8ea2-071174709d04
      iscommand: false
      name: Cortex ASM - Prisma Cloud Enrichment
      playbookId: Cortex ASM - Prisma Cloud Enrichment
      type: playbook
      version: -1
    taskid: 33b5f244-158e-4055-8ea2-071174709d04
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3830
        }
      }
  "80":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: alert.asmtags.value
                    operator: containsGeneral
                    right:
                      value:
                        simple: '@'
                root: alert.asmtags.value
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: '[\w-\.]+@[\w-]+\.+[\w-]{2,4}'
                    unpack_matches: {}
                  operator: RegexExtractAll
                - operator: uniq
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "80"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "97"
      "yes":
      - "81"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if there is email in the tags.
      id: af181638-5ed5-4f7c-8bf7-7f4df1a599f9
      iscommand: false
      name: Are there any emails in tags?
      type: condition
      version: -1
    taskid: af181638-5ed5-4f7c-8bf7-7f4df1a599f9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4330
        }
      }
  "81":
    continueonerrortype: ""
    id: "81"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "83"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9bc2e83d-9759-4ad7-874b-7160b332f745
      iscommand: false
      name: Service Owner from Tags
      type: title
      version: -1
    taskid: 9bc2e83d-9759-4ad7-874b-7160b332f745
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4550
        }
      }
  "83":
    continueonerrortype: ""
    id: "83"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "97"
    note: false
    quietmode: 0
    scriptarguments:
      gridfield:
        simple: asmserviceownerunrankedraw
      keys:
        simple: name,email,source,timestamp
      val1:
        simple: n/a
      val2:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmtags.value
              operator: containsGeneral
              right:
                value:
                  simple: '@'
          root: alert.asmtags.value
          transformers:
          - args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: '[\w-\.]+@[\w-]+\.+[\w-]{2,4}'
              unpack_matches: {}
            operator: RegexExtractAll
          - operator: uniq
      val3:
        complex:
          accessor: source
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmtags.value
              operator: match
              right:
                value:
                  simple: '[\w-\.]+@[\w-]+\.+[\w-]{2,4}'
          root: alert.asmtags
          transformers:
          - args:
              prefix:
                value:
                  simple: Owner-In-Tags-From-
              suffix: {}
            operator: concat
          - operator: uniq
      val4:
        simple: TIMESTAMP
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      id: d29645b0-19f5-4e46-82ac-beede94c4bd9
      iscommand: false
      name: Set service owners from Tag grid field
      script: GridFieldSetup
      type: regular
      version: -1
    taskid: d29645b0-19f5-4e46-82ac-beede94c4bd9
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4750
        }
      }
  "84":
    continueonerrortype: ""
    id: "84"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      ASMRuleID:
        complex:
          accessor: asmattacksurfaceruleid
          root: alert
      AWSAssumeRoleName:
        simple: ${inputs.AWSAssumeRoleName}
      RemoteIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches AWS information relevant
        to ASM alerts.
      id: c3732300-6afd-41f4-875b-ceb13fd60602
      iscommand: false
      name: Cortex ASM - AWS Enrichment
      playbookId: Cortex ASM - AWS Enrichment
      type: playbook
      version: -1
    taskid: c3732300-6afd-41f4-875b-ceb13fd60602
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1905
        }
      }
  "85":
    continueonerrortype: ""
    id: "85"
    ignoreworker: true
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "87"
    note: false
    quietmode: 0
    scriptarguments:
      execution-timeout:
        simple: "3660"
      seconds:
        simple: "3600"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sleep for X seconds
      id: 80101a3f-0873-4d9a-851c-7b2575fa549d
      iscommand: false
      name: Sleep for 1 hour
      script: Sleep
      type: regular
      version: -1
    taskid: 80101a3f-0873-4d9a-851c-7b2575fa549d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 70,
          "y": 530
        }
      }
  "86":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ASM.ExternalService
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "86"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "67"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if there was a result from the previous command to continue
        cloud enrichment.
      id: 805cd227-daf3-4d45-8e8c-2a11243098a5
      iscommand: false
      name: Was there a result?
      type: condition
      version: -1
    taskid: 805cd227-daf3-4d45-8e8c-2a11243098a5
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 70,
          "y": 850
        }
      }
  "87":
    continueonerrortype: ""
    id: "87"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "86"
    note: false
    quietmode: 0
    scriptarguments:
      service_id:
        complex:
          accessor: asmserviceid
          root: alert
          transformers:
          - args:
              chars:
                value:
                  simple: '[\"]'
            operator: StripChars
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex Attack Surface Management
      description: Get service details according to the service ID.
      id: 350fac51-2202-4455-8159-cce6451770f1
      iscommand: true
      name: Get external service information
      script: Cortex Attack Surface Management|||asm-get-external-service
      type: regular
      version: -1
    taskid: 350fac51-2202-4455-8159-cce6451770f1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 70,
          "y": 690
        }
      }
  "88":
    continueonerrortype: ""
    id: "88"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      RemoteIP:
        complex:
          root: inputs.RemoteIP
      RemotePort:
        complex:
          accessor: remoteport
          root: alert
      RemoteProtocol:
        simple: ${alert.asmprotocol}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Given an IP address, port, and protocol of a service, this playbook enriches on-prem integrations to find the related firewall rule and other related information.

        Conditions:
        - Multiple integration instances configured at the same time are not supported (Panorama or standalone NGFW).
        - !pan-os-security-policy-match fails if any firewall is disconnected (Panorama).
        - Matching on different rules for different firewalls not supported (Panorama).
      id: b07b7459-0949-49cf-8999-f948d80d80ea
      iscommand: false
      name: Cortex ASM - On Prem Enrichment
      playbookId: Cortex ASM - On Prem Enrichment
      type: playbook
      version: -1
    taskid: b07b7459-0949-49cf-8999-f948d80d80ea
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 1575
        }
      }
  "89":
    continueonerrortype: ""
    id: "89"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "62"
    note: false
    quietmode: 0
    scriptarguments:
      search_terms:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-NAME
            - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-ID
          root: alert.asmsystemids
          transformers:
          - args:
              field:
                value:
                  simple: id
            operator: getField
          - operator: uniq
          - args:
              regex:
                value:
                  simple: '[nN]/[aA]'
              replaceWith: {}
            operator: replaceMatch
          - args:
              empty_values: {}
              remove_keys: {}
            operator: RemoveEmpty
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 29ba4079-59ee-45ff-80af-02184e6a9498
      iscommand: false
      name: Cortex ASM - ServiceNow ITSM Enrichment
      playbookId: Cortex ASM - ServiceNow ITSM Enrichment
      type: playbook
      version: -1
    taskid: 29ba4079-59ee-45ff-80af-02184e6a9498
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2375
        }
      }
  "90":
    continueonerrortype: ""
    id: "90"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "79"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f2a61868-2a5a-4466-888b-54c6fc9e9506
      iscommand: false
      name: Prisma Cloud Enrichment
      type: title
      version: -1
    taskid: f2a61868-2a5a-4466-888b-54c6fc9e9506
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3700
        }
      }
  "94":
    continueonerrortype: ""
    id: "94"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "80"
    note: false
    quietmode: 0
    scriptarguments:
      RemoteIP:
        simple: ${inputs.RemoteIP}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: This playbook is used to pull information from Cortex Endpoint
        (XSIAM/XDR) systems for enrichment purposes.
      id: 9c4905fa-5964-4580-8e25-04ecd059876c
      iscommand: false
      name: Cortex ASM - Cortex Endpoint Enrichment
      playbookId: Cortex ASM - Cortex Endpoint Enrichment
      type: playbook
      version: -1
    taskid: 9c4905fa-5964-4580-8e25-04ecd059876c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4160
        }
      }
  "95":
    continueonerrortype: ""
    id: "95"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "94"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: aaf47d44-6987-4613-8046-c259fadeeed4
      iscommand: false
      name: Cortex Endpoint Enrichment
      type: title
      version: -1
    taskid: aaf47d44-6987-4613-8046-c259fadeeed4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4010
        }
      }
  "96":
    continueonerrortype: ""
    id: "96"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "99"
    note: false
    quietmode: 0
    scriptarguments:
      serviceowner:
        simple: ${alert.asmserviceownerunrankedraw.email}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Playbook to enriches Service ownership info in Azure and On-Prem
        Active Directory.
      id: 2d8bce46-2353-4a06-84d7-872f9754b104
      iscommand: false
      name: Cortex ASM - Active Directory Enrichment
      playbookId: Cortex ASM - Active Directory Enrichment
      type: playbook
      version: -1
    taskid: 2d8bce46-2353-4a06-84d7-872f9754b104
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5250
        }
      }
  "97":
    continueonerrortype: ""
    id: "97"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "96"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1b6321cb-ce11-458c-85f7-34c8b1cac35c
      iscommand: false
      name: Active Directory Enrichment
      type: title
      version: -1
    taskid: 1b6321cb-ce11-458c-85f7-34c8b1cac35c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5100
        }
      }
  "98":
    continueonerrortype: ""
    id: "98"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "101"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 72c1d079-510c-494d-81b0-7039b82cf0e6
      iscommand: false
      name: Cortex ASM - Certificate Enrichment
      playbookId: Cortex ASM - Certificate Enrichment
      type: playbook
      version: -1
    taskid: 72c1d079-510c-494d-81b0-7039b82cf0e6
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5570
        }
      }
  "99":
    continueonerrortype: ""
    id: "99"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "98"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 2f3562ff-a7c6-445d-8018-fd12a2511fd3
      iscommand: false
      name: Certificate Enrichment
      type: title
      version: -1
    taskid: 2f3562ff-a7c6-445d-8018-fd12a2511fd3
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5420
        }
      }
  "101":
    continueonerrortype: ""
    id: "101"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "102"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5359d5b0-43f4-483d-86a6-82ad3bbe970b
      iscommand: false
      name: Domain Enrichment
      type: title
      version: -1
    taskid: 5359d5b0-43f4-483d-86a6-82ad3bbe970b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5730
        }
      }
  "102":
    continueonerrortype: ""
    id: "102"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "68"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 1fc05b0e-0441-4d2a-8d46-2d2bb8be26d2
      iscommand: false
      name: Cortex ASM - Domain Enrichment
      playbookId: Cortex ASM - Domain Enrichment
      type: playbook
      version: -1
    taskid: 1fc05b0e-0441-4d2a-8d46-2d2bb8be26d2
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5860
        }
      }
  "103":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: alert.asmprotocol
          operator: isNotEmpty
      - - left:
            iscontext: true
            value:
              simple: alert.asmprovider
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "103"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "35"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if there was a result from the previous command to continue
        cloud enrichment.
      id: 3cd0da0e-9611-4d28-8ba2-ed7deee88a19
      iscommand: false
      name: Are provider and protocol fields populated?
      type: condition
      version: -1
    taskid: 3cd0da0e-9611-4d28-8ba2-ed7deee88a19
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 190
        }
      }
  "104":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: Amazon Web Services
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: AWS
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: Google
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: GCP
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: Azure
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: Azure
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: On Prem
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: On Prem
    continueonerrortype: ""
    id: "104"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines which cloud provider the service is in order to direct
        to the correct enrichment.
      id: a7910781-2d89-4c15-83ae-27608a35b2c2
      iscommand: false
      name: What provider is this service?
      type: condition
      version: -1
    taskid: a7910781-2d89-4c15-83ae-27608a35b2c2
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 820,
          "y": 1020
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "103_35_yes": 0.36,
      "11_1_#default#": 0.2,
      "1_3_yes": 0.24,
      "7_1_#default#": 0.35,
      "7_69_Azure": 0.81,
      "80_97_#default#": 0.9
    },
    "paper": {
      "dimensions": {
        "height": 6385,
        "width": 1950,
        "x": -230,
        "y": 60
      }
    }
  }
