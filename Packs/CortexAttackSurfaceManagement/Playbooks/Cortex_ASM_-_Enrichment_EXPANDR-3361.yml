contentitemexportablefields:
  contentitemfields: {}
description: Used as a container folder for all enrichments of ASM alerts.
id: Cortex ASM - Enrichment_EXPANDR-3361
inputs:
- description: IP address of service
  key: RemoteIP
  playbookInputQuery:
  required: false
  value:
    complex:
      accessor: remoteip
      root: alert
- description: If assuming roles for AWS, this is the name of the role to assume (should be the same for all organizations).
  key: AWSAssumeRoleName
  playbookInputQuery:
  required: false
  value: {}
name: Cortex ASM - Enrichment_EXPANDR-3361
outputs:
- contextPath: ASM.ExternalService.externally_detected_providers
  description: Providers of the external service.
  type: unknown
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 707ae055-ad09-4095-8efe-52e6f420c6d6
      iscommand: false
      name: ""
      version: -1
      description: ''
    taskid: 707ae055-ad09-4095-8efe-52e6f420c6d6
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 460,
          "y": -130
        }
      }
  "1":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if the IP address has been supplied to proceed with cloud enrichment.
      id: afac9400-fc75-453d-846f-273e3bbf13cc
      iscommand: false
      name: Is there an IP address?
      type: condition
      version: -1
    taskid: afac9400-fc75-453d-846f-273e3bbf13cc
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 110,
          "y": 1575
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "61"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 2956f9c9-4e87-450a-8ba6-7f9ebe1b0d52
      iscommand: false
      name: ServiceNow Enrichment
      type: title
      version: -1
      description: ''
    taskid: 2956f9c9-4e87-450a-8ba6-7f9ebe1b0d52
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2080
        }
      }
  "6":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ASM.ExternalService
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "85"
      "yes":
      - "67"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if there was a result from the previous command to continue cloud enrichment.
      id: ccfecc2c-304e-4628-838a-be37eb08e210
      iscommand: false
      name: Was there a result?
      type: condition
      version: -1
    taskid: ccfecc2c-304e-4628-838a-be37eb08e210
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 435
        }
      }
  "7":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: Amazon Web Services
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: AWS
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: Google
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: GCP
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: Azure
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: Azure
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: externally_detected_providers
                root: ASM.ExternalService
          operator: containsGeneral
          right:
            value:
              simple: On Prem
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.RemoteIP
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: \b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b
                    unpack_matches: {}
                  operator: RegexExtractAll
          operator: isNotEmpty
      label: On Prem
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      AWS:
      - "84"
      Azure:
      - "69"
      GCP:
      - "76"
      On Prem:
      - "88"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines which cloud provider the service is in order to direct to the correct enrichment.
      id: fa0c0f0c-d963-436c-8d42-be65f5678b2d
      iscommand: false
      name: What provider is this service?
      type: condition
      version: -1
    taskid: fa0c0f0c-d963-436c-8d42-be65f5678b2d
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1400
        }
      }
  "11":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Cortex Attack Surface Management
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
          right:
            value: {}
      - - left:
            iscontext: true
            value:
              complex:
                accessor: asmserviceid
                root: alert
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "66"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if the "Cortex Attack Surface Management" integration instance is configured and that there is a service to continue with enrichment.
      id: e71df879-5af3-4121-8f31-faa72ced0d55
      iscommand: false
      name: Is Cortex ASM enabled and is there a service?
      type: condition
      version: -1
    taskid: e71df879-5af3-4121-8f31-faa72ced0d55
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 0
        }
      }
  "35":
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e424f88e-a401-416a-83c0-e6c9217e38b8
      iscommand: false
      name: Cloud Enrichment
      type: title
      version: -1
      description: ''
    taskid: e424f88e-a401-416a-83c0-e6c9217e38b8
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1265
        }
      }
  "38":
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 90713529-2cdf-4dbf-8f9f-9d359fd604c6
      iscommand: false
      name: Complete
      type: title
      version: -1
      description: ''
    taskid: 90713529-2cdf-4dbf-8f9f-9d359fd604c6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5610
        }
      }
  "61":
    continueonerrortype: ""
    id: "61"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "89"
    note: false
    quietmode: 0
    scriptarguments:
      RemoteIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 7117f72b-178d-4f7f-837a-b81dda158360
      iscommand: false
      name: Cortex ASM - ServiceNow CMDB Enrichment
      playbookId: Cortex ASM - ServiceNow CMDB Enrichment
      type: playbook
      version: -1
      description: ''
    taskid: 7117f72b-178d-4f7f-837a-b81dda158360
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2210
        }
      }
  "62":
    continueonerrortype: ""
    id: "62"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "63"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5145cb80-4830-4c71-8825-e449be9e5cdc
      iscommand: false
      name: Tenable.io Enrichment
      type: title
      version: -1
      description: ''
    taskid: 5145cb80-4830-4c71-8825-e449be9e5cdc
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2540
        }
      }
  "63":
    continueonerrortype: ""
    id: "63"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "70"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches Tenable.io information relevant to ASM alerts.
      id: 1bd916b2-fada-4a0e-82af-498ee53be767
      iscommand: false
      name: Cortex ASM - Tenable.io Enrichment
      playbookId: Cortex ASM - Tenable.io Enrichment
      type: playbook
      version: -1
    taskid: 1bd916b2-fada-4a0e-82af-498ee53be767
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2670
        }
      }
  "66":
    continueonerrortype: ""
    id: "66"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      service_id:
        complex:
          accessor: asmserviceid
          root: alert
          transformers:
          - args:
              chars:
                value:
                  simple: '[\"]'
            operator: StripChars
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex Attack Surface Management
      description: Get service details according to the service ID.
      id: 767d896c-a426-4936-8b95-9d17d79a9a59
      iscommand: true
      name: Get external service information
      script: Cortex Attack Surface Management|||asm-get-external-service
      type: regular
      version: -1
    taskid: 767d896c-a426-4936-8b95-9d17d79a9a59
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 460,
          "y": 270
        }
      }
  "67":
    continueonerrortype: ""
    id: "67"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    scriptarguments:
      protocol:
        complex:
          accessor: protocol
          root: ASM.ExternalService
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 417cd33b-1bae-4810-89d9-9c8bf20da579
      iscommand: true
      name: Set protocol
      script: Builtin|||setAlert
      type: regular
      version: -1
    taskid: 417cd33b-1bae-4810-89d9-9c8bf20da579
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1100
        }
      }
  "68":
    continueonerrortype: ""
    id: "68"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "78"
    note: false
    quietmode: 0
    scriptarguments:
      active_classifications:
        complex:
          accessor: active_classifications
          root: ASM.ExternalService
      asm_tags:
        complex:
          accessor: asmtags
          root: alert
      hierarchy_info:
        complex:
          accessor: asmassethierarchy
          root: alert
          transformers:
          - args:
              delimiter:
                value:
                  simple: /
            operator: split
      provider:
        complex:
          accessor: provider
          root: alert.asmcloud
          transformers:
          - operator: FirstArrayElement
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Identify whether the service is a "development" server. Development servers have no external users and run no production workflows. These servers might be named "dev", but they might also be named "qa", "pre-production", "user acceptance testing", or use other non-production terms. This automation uses both public data visible to anyone (`active_classifications` as derived by Xpanse ASM) as well as checking internal data for AI-learned indicators of development systems (`asm_tags` as derived from integrations with non-public systems).
      id: ed952f0e-11c6-4885-882d-6e8ff891c607
      iscommand: false
      name: Infer whether service is used for development (vs. production)
      script: InferWhetherServiceIsDev
      type: regular
      version: -1
    taskid: ed952f0e-11c6-4885-882d-6e8ff891c607
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5280
        }
      }
  "69":
    continueonerrortype: ""
    id: "69"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      RemoteIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address, this playbook enriches Azure information relevant to ASM alerts.
      id: eee181a6-dd94-4a76-8931-14c08bd4f629
      iscommand: false
      name: Cortex ASM - Azure Enrichment
      playbookId: Cortex ASM - Azure Enrichment
      type: playbook
      version: -1
    taskid: eee181a6-dd94-4a76-8931-14c08bd4f629
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 1680
        }
      }
  "70":
    continueonerrortype: ""
    id: "70"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "71"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cfc67225-41c6-4c9d-8da6-049af541962a
      iscommand: false
      name: Splunk Enrichment
      type: title
      version: -1
      description: ''
    taskid: cfc67225-41c6-4c9d-8da6-049af541962a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2830
        }
      }
  "71":
    continueonerrortype: ""
    id: "71"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "73"
    note: false
    quietmode: 0
    scriptarguments:
      IP:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: 'Given the IP address this playbook enriches information from Splunk results relevant to ASM alerts. '
      id: 77e554f5-6d68-4c68-8b01-a5b02728d97c
      iscommand: false
      name: Cortex ASM - Splunk Enrichment
      playbookId: Cortex ASM - Splunk Enrichment
      type: playbook
      version: -1
    taskid: 77e554f5-6d68-4c68-8b01-a5b02728d97c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2960
        }
      }
  "72":
    continueonerrortype: ""
    id: "72"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "74"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches Rapid7 InsightVM (Nexpose) information relevant to ASM alerts.
      id: 26a8fb38-eece-4f85-8772-a5bea1ef5bf3
      iscommand: false
      name: Cortex ASM - Rapid7 Enrichment
      playbookId: Cortex ASM - Rapid7 Enrichment
      type: playbook
      version: -1
    taskid: 26a8fb38-eece-4f85-8772-a5bea1ef5bf3
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3250
        }
      }
  "73":
    continueonerrortype: ""
    id: "73"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "72"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ff4cb6f6-4a95-480d-8372-274be35cd716
      iscommand: false
      name: Rapid7 Enrichment
      type: title
      version: -1
      description: ''
    taskid: ff4cb6f6-4a95-480d-8372-274be35cd716
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3120
        }
      }
  "74":
    continueonerrortype: ""
    id: "74"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "75"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e0c3749d-a1a8-48d0-839f-f46bced5908a
      iscommand: false
      name: Qualys Enrichment
      type: title
      version: -1
      description: ''
    taskid: e0c3749d-a1a8-48d0-839f-f46bced5908a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3410
        }
      }
  "75":
    continueonerrortype: ""
    id: "75"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "90"
    note: false
    quietmode: 0
    scriptarguments:
      QualysIP:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches information from Qualys assets.
      id: d89b0824-c2db-4763-8a5f-6abc308a1bbc
      iscommand: false
      name: Cortex ASM - Qualys Enrichment
      playbookId: Cortex ASM - Qualys Enrichment
      type: playbook
      version: -1
    taskid: d89b0824-c2db-4763-8a5f-6abc308a1bbc
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3540
        }
      }
  "76":
    continueonerrortype: ""
    id: "76"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches GCP information relevant to ASM alerts.
      id: 68c813fd-d7ac-42c7-816d-491602271006
      iscommand: false
      name: Cortex ASM - GCP Enrichment
      playbookId: Cortex ASM - GCP Enrichment
      type: playbook
      version: -1
    taskid: 68c813fd-d7ac-42c7-816d-491602271006
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 800,
          "y": 1790
        }
      }
  "78":
    continueonerrortype: ""
    id: "78"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "38"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 2c9ccf25-d6d7-4190-8c99-1fc8070543b8
      iscommand: false
      name: Cortex ASM - Service Ownership
      playbookId: Cortex ASM - Service Ownership
      type: playbook
      version: -1
      description: ''
    taskid: 2c9ccf25-d6d7-4190-8c99-1fc8070543b8
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 110,
          "y": 5440
        }
      }
  "79":
    continueonerrortype: ""
    id: "79"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "91"
    note: false
    quietmode: 0
    scriptarguments:
      cloudProvider:
        complex:
          accessor: externally_detected_providers
          root: ASM.ExternalService
      remoteIP:
        complex:
          root: inputs.RemoteIP
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches information from Prisma Cloud.
      id: 30f84900-27fd-424d-8051-a91c4d87af6d
      iscommand: false
      name: Cortex ASM - Prisma Cloud Enrichment
      playbookId: Cortex ASM - Prisma Cloud Enrichment
      type: playbook
      version: -1
    taskid: 30f84900-27fd-424d-8051-a91c4d87af6d
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3830
        }
      }
  "80":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: alert.asmtags.value
                    operator: containsGeneral
                    right:
                      value:
                        simple: '@'
                root: alert.asmtags.value
                transformers:
                - args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: '[\w-\.]+@[\w-]+\.+[\w-]{2,4}'
                    unpack_matches: {}
                  operator: RegexExtractAll
                - operator: uniq
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "80"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "81"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if there is email in the tags.
      id: eed7577f-162a-4042-8eaa-c4384adef815
      iscommand: false
      name: Are there any emails in tags?
      type: condition
      version: -1
    taskid: eed7577f-162a-4042-8eaa-c4384adef815
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4570
        }
      }
  "81":
    continueonerrortype: ""
    id: "81"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "82"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f0de2cb0-8219-45d8-8f48-7b60800debd4
      iscommand: false
      name: Service Owner from Tags
      type: title
      version: -1
      description: ''
    taskid: f0de2cb0-8219-45d8-8f48-7b60800debd4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4820
        }
      }
  "82":
    continueonerrortype: ""
    id: "82"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "83"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Retrieves the current date and time.
      id: 89126ba3-8333-4af3-8f83-616e09d691fd
      iscommand: false
      name: Get current time
      script: GetTime
      type: regular
      version: -1
    taskid: 89126ba3-8333-4af3-8f83-616e09d691fd
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4950
        }
      }
  "83":
    continueonerrortype: ""
    id: "83"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "68"
    note: false
    quietmode: 0
    scriptarguments:
      gridfield:
        simple: asmserviceowner
      keys:
        simple: name,email,source,timestamp
      val1:
        simple: n/a
      val2:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmtags.value
              operator: containsGeneral
              right:
                value:
                  simple: '@'
          root: alert.asmtags.value
          transformers:
          - args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: '[\w-\.]+@[\w-]+\.+[\w-]{2,4}'
              unpack_matches: {}
            operator: RegexExtractAll
          - operator: uniq
      val3:
        complex:
          accessor: source
          root: alert.asmtags
          transformers:
          - args:
              prefix:
                value:
                  simple: Owner-In-Tags-From-
              suffix: {}
            operator: concat
          - operator: uniq
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      id: 78f5637d-4f48-41ab-841b-895674d3abcb
      iscommand: false
      name: Set service owners from Tag grid field
      script: GridFieldSetup
      type: regular
      version: -1
    taskid: 78f5637d-4f48-41ab-841b-895674d3abcb
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 460,
          "y": 5110
        }
      }
  "84":
    continueonerrortype: ""
    id: "84"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      ASMRuleID:
        complex:
          accessor: asmattacksurfaceruleid
          root: alert
      AWSAssumeRoleName:
        simple: ${inputs.AWSAssumeRoleName}
      RemoteIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Given the IP address this playbook enriches AWS information relevant to ASM alerts.
      id: 050b5d22-2fb0-4814-8276-f08c52d61550
      iscommand: false
      name: Cortex ASM - AWS Enrichment
      playbookId: Cortex ASM - AWS Enrichment
      type: playbook
      version: -1
    taskid: 050b5d22-2fb0-4814-8276-f08c52d61550
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1905
        }
      }
  "85":
    continueonerrortype: ""
    id: "85"
    ignoreworker: true
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "87"
    note: false
    quietmode: 0
    scriptarguments:
      execution-timeout:
        simple: "3660"
      seconds:
        simple: "3600"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sleep for X seconds
      id: 3461edd7-5812-4d17-8400-790a579d22f9
      iscommand: false
      name: Sleep for 1 hour
      script: Sleep
      type: regular
      version: -1
    taskid: 3461edd7-5812-4d17-8400-790a579d22f9
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 940,
          "y": 610
        }
      }
  "86":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ASM.ExternalService
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "86"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "67"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if there was a result from the previous command to continue cloud enrichment.
      id: 38d3fe39-1010-4002-8b80-ac576f6ff0de
      iscommand: false
      name: Was there a result?
      type: condition
      version: -1
    taskid: 38d3fe39-1010-4002-8b80-ac576f6ff0de
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 940,
          "y": 930
        }
      }
  "87":
    continueonerrortype: ""
    id: "87"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "86"
    note: false
    quietmode: 0
    scriptarguments:
      service_id:
        complex:
          accessor: asmserviceid
          root: alert
          transformers:
          - args:
              chars:
                value:
                  simple: '[\"]'
            operator: StripChars
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex Attack Surface Management
      description: Get service details according to the service ID.
      id: c6dcc51d-3f02-4487-83a9-8792a9ffe086
      iscommand: true
      name: Get external service information
      script: Cortex Attack Surface Management|||asm-get-external-service
      type: regular
      version: -1
    taskid: c6dcc51d-3f02-4487-83a9-8792a9ffe086
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 940,
          "y": 770
        }
      }
  "88":
    continueonerrortype: ""
    id: "88"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      RemoteIP:
        complex:
          root: inputs.RemoteIP
      RemotePort:
        complex:
          accessor: remoteport
          root: alert
      RemoteProtocol:
        complex:
          accessor: protocol
          root: alert
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 125cd39f-8428-4912-814d-24dccb282501
      iscommand: false
      name: Cortex ASM - On Prem Enrichment
      playbookId: Cortex ASM - On Prem Enrichment
      type: playbook
      version: -1
      description: ''
    taskid: 125cd39f-8428-4912-814d-24dccb282501
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 1575
        }
      }
  "89":
    continueonerrortype: ""
    id: "89"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "62"
    note: false
    quietmode: 0
    scriptarguments:
      search_terms:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-NAME
            - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-ID
          root: alert.asmsystemids
          transformers:
          - args:
              field:
                value:
                  simple: id
            operator: getField
          - operator: uniq
          - args:
              regex:
                value:
                  simple: '[nN]/[aA]'
              replaceWith: {}
            operator: replaceMatch
          - args:
              empty_values: {}
              remove_keys: {}
            operator: RemoveEmpty
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: e59153b9-d279-4431-85cd-6995de62fd4c
      iscommand: false
      name: Cortex ASM - ServiceNow ITSM Enrichment
      playbookId: Cortex ASM - ServiceNow ITSM Enrichment
      type: playbook
      version: -1
      description: ''
    taskid: e59153b9-d279-4431-85cd-6995de62fd4c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2375
        }
      }
  "90":
    continueonerrortype: ""
    id: "90"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "79"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cc19c840-2c26-4065-851e-67a9ef8b327c
      iscommand: false
      name: Prisma Cloud Enrichment
      type: title
      version: -1
      description: ''
    taskid: cc19c840-2c26-4065-851e-67a9ef8b327c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3700
        }
      }
  "91":
    continueonerrortype: ""
    id: "91"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "93"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 160f232f-015d-41f0-8607-f5907e0ac530
      iscommand: false
      name: Active Directory Enrichment
      type: title
      version: -1
      description: ''
    taskid: 160f232f-015d-41f0-8607-f5907e0ac530
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3990
        }
      }
  "93":
    continueonerrortype: ""
    id: "93"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "95"
    note: false
    quietmode: 0
    scriptarguments:
      serviceowner:
        simple: ${alert.asmserviceowner.email}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Playbook to enriches Service owner in Azure directory.
      id: 3a35a0de-0312-4243-8dd6-31f69c85dc65
      iscommand: false
      name: Cortex ASM - Active Directory Enrichment
      playbookId: Cortex ASM - Active Directory Enrichment
      type: playbook
      version: -1
    taskid: 3a35a0de-0312-4243-8dd6-31f69c85dc65
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4120
        }
      }
  "94":
    continueonerrortype: ""
    id: "94"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "80"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 4906268f-aa71-4a49-8ea9-dcba3e82d854
      iscommand: false
      name: Cortex ASM - Cortex Endpoint Enrichment_Core_Combo
      playbookId: Cortex ASM - Cortex Endpoint Enrichment_Core_Combo
      type: playbook
      version: -1
      description: ''
    taskid: 4906268f-aa71-4a49-8ea9-dcba3e82d854
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4410
        }
      }
  "95":
    continueonerrortype: ""
    id: "95"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "94"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9c813673-63e0-486f-817d-68b806197243
      iscommand: false
      name: Cortex Endpoint Enrichment
      type: title
      version: -1
      description: ''
    taskid: 9c813673-63e0-486f-817d-68b806197243
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 4280
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "11_1_#default#": 0.2,
      "11_66_yes": 0.59,
      "1_3_yes": 0.24,
      "6_67_yes": 0.62,
      "7_1_#default#": 0.35,
      "7_69_Azure": 0.81
    },
    "paper": {
      "dimensions": {
        "height": 5805,
        "width": 1610,
        "x": 110,
        "y": -130
      }
    }
  }
tests:
- No tests (auto formatted)
fromversion: 6.8.0
